{% ckan_extends %}

{% block stages %}
  {% if stage %}
    {% if pkg_dict and pkg_dict.kobo_asset_id %}
      {{ h.snippet('package/snippets/import-kobo-stages.html', stages=stage, kobo_asset_id=data.kobo_asset_id) }}
    {% else %}
      {{ h.snippet('package/snippets/stages.html', stages=stage, pkg_name=pkg_name) }}
    {% endif %}
  {% endif %}


  {% if pkg_dict and 
        pkg_dict.kobo_asset_id and 
        pkg_dict.state == 'draft' and 
        not data %}
    {# We are just after a new package is created. We are not editing a resource #}

  <div class="special-resources-container">
    {# show all special resources #}
    {% for resource in pkg_dict.resources %}
    
      {# TODO use resource extras.special if available #}
      {% set is_data = resource.name == 'Survey JSON data' %}
      {% set is_questionnaire = resource.name == 'Questionnaire XLS' %}
      {% if is_data %}
        {{ h.snippet('package/snippets/survey_data.html', resource=resource) }}
      {% elif is_questionnaire %}
        {{ h.snippet('package/snippets/survey_questionnaire.html', resource=resource) }}
      {% endif %}
    {% endfor %}

    <div class="special-resources-publish">
      <b>If the resources are ready you can</b>
      <a
        href="{% url_for 'unhcr_dataset.publish', dataset_id=pkg_dict.id %}"
        class="btn btn-success">
          {{ _('Publish Dataset') }}
      </a>
    </div>
    
  </div>

  <h2>Or you can add more resources</h2>
  
{% endif %}

{% endblock %}

{% block basic_fields %}
  <div class="info-block" id="upload-size-info-block" style="display:none;">
    <i class="fa fa-info-circle"></i>
    Max upload size: {{ h.get_max_resource_size() }}Mb
  </div>
  {{ super() }}
{% endblock %}
